/* app.js v1.1.9 (minified production build) */
window.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("js-version");e&&(e.textContent="v1.1.9")});function isRedgifsURL(e){return!!e&&(e.includes("redgifs.com")||e.includes("v2.redgifs.com")||e.includes("out.reddit.com")&&e.includes("redgifs"))}function extractRedgifsSlug(e){if(!e)return null;if(e.includes("out.reddit.com")){let t=new URL(e).searchParams.get("url");t&&(e=t)}let t=[/redgifs\.com\/watch\/([A-Za-z0-9]+)/,/redgifs\.com\/ifr\/([A-Za-z0-9]+)/,/\/([A-Za-z0-9]+)$/];for(let r of t){let t=e.match(r);if(t)return t[1]}return null}async function fetchRedgifsMP4(e){let t=extractRedgifsSlug(e);return t?new Promise(r=>{const n=document.createElement("iframe");n.src=`https://www.redgifs.com/ifr/${t}`,n.style.position="fixed",n.style.bottom="180px",n.style.left="10px",n.style.width="220px",n.style.height="160px",n.style.border="2px solid #0ff",n.style.zIndex="999999",document.body.appendChild(n);let i=0,o=50,a=setInterval(()=>{try{let e=n.contentDocument?.querySelector("video");if(e&&e.src?.startsWith("https"))return clearInterval(a),void r(e.src)}catch(e){}++i>=o&&(clearInterval(a),r(null))},350)}):null}function extractUsername(e){if(!e)return null;if(e=e.trim(),e.match(/\/u\/([^\/]+)/i))return e.match(/\/u\/([^\/]+)/i)[1];if(e.match(/reddit\.com\/user\/([^\/]+)/i))return e.match(/reddit\.com\/user\/([^\/]+)/i)[1];if(e.match(/\bu\/([A-Za-z0-9_-]+)/i))return e.match(/\bu\/([A-Za-z0-9_-]+)/i)[1];return/^[A-Za-z0-9_-]{2,30}$/.test(e)?e:null}function isGif(e){return!!e&&(e.endsWith(".gif")||e.endsWith(".gifv")||e.includes("imgur.com")&&e.match(/\.gifv?$/)||e.includes("gfycat"))}function convertGifToMP4(e){return e.includes("i.redd.it")&&e.endsWith(".gif")?e:e.includes("imgur.com")&&e.endsWith(".gifv")?e.replace(".gifv",".mp4"):e.endsWith(".gif")?e.replace(".gif",".mp4"):e}let postMediaList=[],postMediaIndex={};const input=document.getElementById("input"),loadBtn=document.getElementById("loadBtn"),clearBtn=document.getElementById("clearBtn"),copyBtn=document.getElementById("copyBtn"),zipBtn=document.getElementById("zipBtn"),scrollTopBtn=document.getElementById("scrollTopBtn"),results=document.getElementById("results"),imgFilter=document.getElementById("imgFilter"),vidFilter=document.getElementById("vidFilter"),otherFilter=document.getElementById("otherFilter");async function loadPosts(){results.innerHTML="",postMediaList=[],postMediaIndex={};let e=extractUsername(input.value.trim());if(!e)return void(results.innerHTML="<div class='post'>Invalid username or URL.</div>");try{let t=await fetch(`https://api.reddit.com/user/${e}/submitted?raw_json=1`);if(!t.ok)throw Error("Reddit blocked fetch");let r=(await t.json()).data.children;if(!r.length)return void(results.innerHTML="<div class='post'>No posts found.</div>");for(let e of r)await renderPost(e.data)}catch(e){results.innerHTML=`<div class="post">Error: ${e.message}</div>`}}async function renderPost(e){let t=document.createElement("div");t.className="post";let r=document.createElement("div");r.textContent=e.title,r.style.marginBottom="12px",t.appendChild(r);let n=e.url||"",i=e.id;postMediaIndex[i]=postMediaList.length;let o=document.createElement("div");if(o.className="tile-media",imgFilter.checked&&isRedgifsURL(n)){let r=await fetchRedgifsMP4(n);return r?(appendMedia(o,t,r,"gif",e),void results.appendChild(t)):(t.appendChild(errBox("Could not load RedGifs")),void results.appendChild(t))}if(otherFilter.checked&&(n.includes("youtube.com")||n.includes("youtu.be"))){let r=null;return n.match(/v=([^&]+)/)&&(r=n.match(/v=([^&]+)/)[1]),!r&&n.match(/youtu\.be\/([^?]+)/)&&(r=n.match(/youtu\.be\/([^?]+)/)[1]),r?(appendIframe(o,t,`https://www.youtube.com/embed/${r}`),void results.appendChild(t)):void 0}if(otherFilter.checked&&n.includes("vimeo.com")){let e=n.match(/vimeo\.com\/(\d+)/);return e?(appendIframe(o,t,`https://player.vimeo.com/video/${e[1]}`),void results.appendChild(t)):void 0}if(otherFilter.checked&&n.includes("twitch.tv")){let e=n.match(/clip\/([^/?]+)/);return e?(appendIframe(o,t,`https://clips.twitch.tv/embed?clip=${e[1]}&parent=localhost`),void results.appendChild(t)):void 0}if(otherFilter.checked&&(n.includes("pornhub.com")||n.includes("phncdn.com"))){appendIframe(o,t,n.replace("view_video.php?viewkey=","embed/"));return void results.appendChild(t)}if(otherFilter.checked&&n.includes("redtube.com")){let e=n.match(/redtube\.com\/(\d+)/);return e?(appendIframe(o,t,`https://embed.redtube.com/?id=${e[1]}&bgcolor=000000`),void results.appendChild(t)):void 0}if(otherFilter.checked&&n.includes("twitter.com")){appendIframe(o,t,n.replace("twitter.com","twitframe.com"));return void results.appendChild(t)}if(imgFilter.checked&&isGif(n))return appendMedia(o,t,convertGifToMP4(n),"gif",e),void results.appendChild(t);if(imgFilter.checked&&"image"===e.post_hint)return appendMedia(o,t,n,"image",e),void results.appendChild(t);if(vidFilter.checked&&e.is_video&&e.media?.reddit_video?.fallback_url)return appendMedia(o,t,e.media.reddit_video.fallback_url,"video",e),void results.appendChild(t);if(otherFilter.checked){let r=document.createElement("a");return r.href=n,r.textContent=n,r.target="_blank",t.appendChild(r),void results.appendChild(t)}}function appendMedia(e,t,r,n,i){let o="gif"===n&&r.endsWith(".gif")?document.createElement("img"):document.createElement("video");"img"===o.tagName.toLowerCase()?o.src=r:(o.src=r,o.controls="video"===n,o.autoplay="gif"===n,o.loop="gif"===n,o.muted="gif"===n),o.className="",e.appendChild(o);let a=document.createElement("div");a.className="post-url",a.textContent=i.url,t.appendChild(e),t.appendChild(a),postMediaList.push({type:n,src:r,postId:i.id})}function appendIframe(e,t,r){let n=document.createElement("iframe");n.src=r,n.allow="autoplay; encrypted-media",e.appendChild(n),t.appendChild(e)}function errBox(e){let t=document.createElement("div");return t.style.color="#faa",t.textContent=e,t}scrollTopBtn.onclick=()=>{window.scrollTo({top:0,behavior:"smooth"})},loadBtn.onclick=loadPosts,clearBtn.onclick=()=>{input.value="",results.innerHTML="",postMediaList=[],postMediaIndex={}},copyBtn.onclick=()=>{navigator.clipboard.writeText(input.value.trim())},zipBtn.onclick=()=>{alert("ZIP downloads coming soon")};
/* END app.js v1.1.9 */
